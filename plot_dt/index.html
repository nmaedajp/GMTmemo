<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/GMTmemo/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/GMTmemo/css/franklin.css"> <link rel=stylesheet  href="/GMTmemo/css/pure.css"> <link rel=stylesheet  href="/GMTmemo/css/side-menu.css"> <style> .franklin-content{padding-left:10%;} @media (min-width: 940px) { .franklin-content {width: 700px; margin-left: 0px; padding-left: 80px;} .header {width: 700px;} } </style> <link rel=icon  href="/GMTmemo/assets/favicon.png"> <title>日付型の散布図</title> <div id=layout > <a href="#menu" id=menuLink  class=menu-link ><span></span></a> <div id=menu > <div class=pure-menu > <a class=pure-menu-heading  href="#">GMT</a> <ul class=pure-menu-list > <li class="pure-menu-item "><a href="/GMTmemo/" class=pure-menu-link >Home</a> <li class="pure-menu-item "><a href="/GMTmemo/menu1/" class=pure-menu-link >散布図</a> <li class="pure-menu-item "><a href="/GMTmemo/menu2/" class=pure-menu-link >軸</a> <li class="pure-menu-item "><a href="/GMTmemo/dtaxis" class=pure-menu-link >日付型の軸</a> <li class="pure-menu-item pure-menu-selected"><a href="/GMTmemo/plot_dt" class=pure-menu-link >日付型の散布図</a> <li class="pure-menu-item "><a href="/GMTmemo/griddata/" class=pure-menu-link >グリッドデータ</a> <li class="pure-menu-item "><a href="/GMTmemo/menu3/" class=pure-menu-link >Tags</a> </ul> </div> </div> <div id=main > <div class=header > <h1>日付型の散布図</h1> <h2>GMT.jl 使用メモ</h2> </div> <div class=franklin-content > <div class=franklin-toc ><ol><li><a href="#要点">要点</a><li><a href="#概要">概要</a><li><a href="#ファイルに書き出す">ファイルに書き出す</a><li><a href="#数値に変換する">数値に変換する</a></ol></div> <h1 id="要点"><a href="#要点" class=header-anchor >要点</a></h1> <ul> <li><p>ある時から，日付，日時型のデータがプロットできなくなった．</p> <li><p>GMTDataset の型に日付，日時型が含まれないことによるのか．</p> <li><p>軸作成の上限下限の値としては，使用できる．</p> <li><p>回避策として考えたのは，以下の２つ</p> <ul> <li><p>一旦ファイルに書き出し，ファイルから読み込む．</p> <li><p>日付型を数値に変換する</p> </ul> </ul> <h1 id="概要"><a href="#概要" class=header-anchor >概要</a></h1> <p>日付型のデータについては，<code>GMT.jl</code> の <code>v0.44.5</code> までは，プロットが可能だったが， <code>v0.44.8</code> からプロットができなくなった． バージョンが飛んでいるのは， <code>v0.44.6</code>，<code>v0.44.7</code> をインストールしていなかったため．</p> <p>この状況は，バージョンが <code>v1.xx.x</code> になっても変化していない． &#40;現在は，<code>v1.26.0</code>を使用&#41;</p> <p>エラーの最初の方は， <pre>
ERROR: MethodError: no method matching GMTdataset(::Matrix{…}, 
::Vector{…}, ::Vector{…}, ::Dict{…}, ::Vector{…}, ::Vector{…}, 
::String, ::Vector{…}, ::String, ::String, ::Int64, ::Int64)
The type `GMTdataset` exists, but no method is defined for this 
combination of argument types when trying to construct it.
</pre> となっている． <a href="https://www.generic-mapping-tools.org/GMTjl_doc/documentation/general/types/index.html#dataset_type/">GMTdataset</a> の項目をみると， <pre>
struct GMTdataset{T<:Real, N} <: AbstractArray{T,N}
    data::Array{T,N}           # Mx2 Matrix with segment data
    ds_bbox::Vector{Float64}   # Global BoundingBox (for when there are many segments)
    bbox::Vector{Float64}      # Segment BoundingBox
    attrib::Dict{String, String} # Dictionary with attributes/values (optional)
    colnames::Vector{String}   # Column names. Antecipate using this with a future Tables inerface
    text::Vector{String}       # Array with text after data coordinates (mandatory only when plotting Text)
    header::String             # String with segment header (Optional but sometimes very useful)
    comment::Vector{String}    # Array with any dataset comments [empty after first segment]
    proj4::String              # Projection string in PROJ4 syntax (Optional)
    wkt::String                # Projection string in WKT syntax (Optional)
    epsg::Int                  # EPSG projection code (Optional)
    geom::Integer              # Geometry type. One of the GDAL's enum (wkbPoint, wkbPolygon, etc...)
end
</pre> となっている．<code>T&lt;:Real</code> となっているので，Date型，DateTime型は，含まれていない． これが上のエラーの意味であろう．</p> <p>これを避けるために，２つの手段を考えてみた．</p> <ul> <li><p>一旦，ファイルに書き出して，ファイル名を指定する．</p> <li><p>Date型，DateTime型を数値に変換する</p> </ul> <h1 id="ファイルに書き出す"><a href="#ファイルに書き出す" class=header-anchor >ファイルに書き出す</a></h1> <p>エコではないが，データを一度ファイルに落とし，ファイルのデータをプロットする形を取る．</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> GMT
<span class=hljs-keyword >using</span> Dates
<span class=hljs-keyword >using</span> DelimitedFiles
<span class=hljs-keyword >using</span> Random

nw = now()
ndata = <span class=hljs-number >24</span>
x = <span class=hljs-built_in >Array</span>{DateTime}(<span class=hljs-literal >undef</span>, ndata);
<span class=hljs-keyword >for</span> i=<span class=hljs-number >1</span>:ndata
    x[i] = nw + Hour(i-<span class=hljs-number >1</span>)
<span class=hljs-keyword >end</span>
Random.seed!(<span class=hljs-number >20250220</span>)
y = rand(ndata)
x1 = x[<span class=hljs-number >1</span>] - Hour(<span class=hljs-number >1</span>)
x2 = x[<span class=hljs-keyword >end</span>] + Hour(<span class=hljs-number >1</span>)

flnm = joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;ts_date_data.txt&quot;</span>)
open(flnm, <span class=hljs-string >&quot;w&quot;</span>) <span class=hljs-keyword >do</span> io
    writedlm(io, [x y])
<span class=hljs-keyword >end</span>
flout = joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;plot_dt1&quot;</span>)
gmtbegin(flout, fmt=<span class=hljs-string >&quot;png&quot;</span>)
   basemap(region=(x1, x2, -<span class=hljs-number >0.05</span>, <span class=hljs-number >1.05</span>), B=<span class=hljs-string >&quot;afg&quot;</span>, figsize=(<span class=hljs-number >8</span>, <span class=hljs-number >5</span>))
   scatter(flnm, S=<span class=hljs-string >&quot;c0.15&quot;</span>, G=<span class=hljs-string >&quot;red&quot;</span>, ml=(<span class=hljs-number >0.1</span>,:black))
gmtend()</code></pre> <img src="/GMTmemo/assets/plot_dt/output/plot_dt1.png" alt=""> <h1 id="数値に変換する"><a href="#数値に変換する" class=header-anchor >数値に変換する</a></h1> <p>軸を描くときは，DateTime型のまま使用し， プロットするときは，DateTime型を数値に変換し，再スケーリングする．</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> GMT
<span class=hljs-keyword >using</span> Dates
<span class=hljs-keyword >using</span> Random

nw = now()
ndata = <span class=hljs-number >24</span>
x1 = x[<span class=hljs-number >1</span>] - Hour(<span class=hljs-number >1</span>)
x2 = x[<span class=hljs-keyword >end</span>] + Hour(<span class=hljs-number >1</span>)

x = <span class=hljs-built_in >Array</span>{DateTime}(<span class=hljs-literal >undef</span>, ndata)
<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:ndata
    x[i] = nw + Hour(i)
<span class=hljs-keyword >end</span>
Random.seed!(<span class=hljs-number >20250220</span>)
y = rand(ndata);

flout = joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;plot_dt2&quot;</span>)

gmtbegin(flout, fmt=<span class=hljs-string >&quot;png&quot;</span>)
    basemap(region=(x1, x2, -<span class=hljs-number >0.05</span>, <span class=hljs-number >1.05</span>), J=<span class=hljs-string >&quot;X8c/5c&quot;</span>, B=<span class=hljs-string >&quot;afg WSne&quot;</span>)  <span class=hljs-comment ># DateTime型の軸を描く</span>
    scatter(Dates.value.(x), y, S=<span class=hljs-string >&quot;c0.15&quot;</span>, G=<span class=hljs-string >&quot;red&quot;</span>, ml=(<span class=hljs-number >0.1</span>,:black),  <span class=hljs-comment ># DateTime型を数値に</span>
            region=(Dates.value(x1), Dates.value(x2), -<span class=hljs-number >0.05</span>, <span class=hljs-number >1.05</span>))   <span class=hljs-comment ># DateTime型を数値に変換して，再スケーリング</span>
gmtend()</code></pre> <img src="/GMTmemo/assets/plot_dt/output/plot_dt2.png" alt=""> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Naoki Maeda. Last modified: March 01, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <script src="/GMTmemo/libs/pure/ui.min.js"></script> <script src="/GMTmemo/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>